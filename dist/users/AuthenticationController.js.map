{"version":3,"sources":["../../dist-esnext/users/AuthenticationController.js"],"names":["expiresIn","AuthenticationController","req","res","next","token","body","query","headers","verify","err","decoded","json","success","message","status","send","userName","name","userBusiness","findOne","error","user","password","sign","e"],"mappings":";;;;;;;;AAAA;;;;AACA;;AACA;;AACA;;;;;;;;AACA,IAAMA,YAAY,IAAlB,C,CAAwB;;IAClBC,wB;;;;;;;oCACUC,G,EAAKC,G,EAAKC,I,EAAM;AACxB,gBAAMC,QAAQH,IAAII,IAAJ,CAASD,KAAT,IAAkBH,IAAIK,KAAJ,CAAUF,KAA5B,IAAqCH,IAAIM,OAAJ,CAAY,gBAAZ,CAAnD;AACA,gBAAIH,KAAJ,EAAW;AACP,uCAAII,MAAJ,CAAWJ,KAAX,2BAAgC,UAACK,GAAD,EAAMC,OAAN,EAAkB;AAC9C,wBAAID,GAAJ,EAAS;AACLP,4BAAIS,IAAJ,CAAS,EAAEC,SAAS,KAAX,EAAkBC,SAAS,+BAA3B,EAAT;AACH,qBAFD,MAGK;AACDZ,4BAAIS,OAAJ,GAAcA,OAAd;AACAP;AACH;AACJ,iBARD;AASH,aAVD,MAWK;AACDD,oBAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACjBH,6BAAS,KADQ;AAEjBC,6BAAS;AAFQ,iBAArB;AAIH;AACJ;;;yCACgBZ,G,EAAKC,G,EAAK;AACvB,gBAAI;AACA,oBAAMc,WAAWf,IAAII,IAAJ,CAASY,IAA1B;AACA,oBAAMC,eAAe,4BAArB;AACAA,6BAAaC,OAAb,CAAqBH,QAArB,EAA+B,UAACI,KAAD,EAAQC,IAAR,EAAiB;AAC5C,wBAAID,KAAJ,EACI,OAAOlB,IAAIa,IAAJ,CAAS,EAAEK,OAAO,OAAT,EAAT,CAAP;AACJ,wBAAI,CAACC,IAAL,EACI,OAAOnB,IAAIS,IAAJ,CAAS,EAAEC,SAAS,KAAX,EAAkBC,SAAS,wCAA3B,EAAT,CAAP;AACJ;AACA,wBAAIQ,KAAKC,QAAL,KAAkBrB,IAAII,IAAJ,CAASiB,QAA/B,EACI,OAAOpB,IAAIS,IAAJ,CAAS,EAAEC,SAAS,KAAX,EAAkBC,SAAS,wCAA3B,EAAT,CAAP;AACJ;AACA;AACA,wBAAMT,QAAQ,uBAAImB,IAAJ,CAASF,IAAT,2BAA6B;AACvCtB,4CADuC,CAC7B;AAD6B,qBAA7B,CAAd;AAGA;AACAG,wBAAIS,IAAJ,CAAS;AACLC,iCAAS,IADJ;AAELC,iCAAS,mBAFJ;AAGLT,oCAHK;AAILL;AAJK,qBAAT;AAMH,iBApBD;AAqBH,aAxBD,CAyBA,OAAOyB,CAAP,EAAU;AACN,gCAAIA,CAAJ;AACAtB,oBAAIa,IAAJ,CAAS,EAAEK,OAAO,uBAAT,EAAT;AACH;AACJ;;;;;;kBAEUpB,wB;AACf","file":"AuthenticationController.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport { log } from '../index';\nimport { TOKEN_SECRET } from './../config/constants';\nimport UserBusiness from './../users/UserBusiness';\nconst expiresIn = 1000; // seconds\nclass AuthenticationController {\n    verifyToken(req, res, next) {\n        const token = req.body.token || req.query.token || req.headers['x-access-token'];\n        if (token) {\n            jwt.verify(token, TOKEN_SECRET, (err, decoded) => {\n                if (err) {\n                    res.json({ success: false, message: 'Failed to authenticate token.' });\n                }\n                else {\n                    req.decoded = decoded;\n                    next();\n                }\n            });\n        }\n        else {\n            res.status(403).send({\n                success: false,\n                message: 'No token provided.'\n            });\n        }\n    }\n    authenticateUser(req, res) {\n        try {\n            const userName = req.body.name;\n            const userBusiness = new UserBusiness();\n            userBusiness.findOne(userName, (error, user) => {\n                if (error)\n                    return res.send({ error: 'error' });\n                if (!user)\n                    return res.json({ success: false, message: 'Authentication failed. User not found.' });\n                // check if password matches\n                if (user.password !== req.body.password)\n                    return res.json({ success: false, message: 'Authentication failed. Wrong password.' });\n                // if user is found and password is right\n                // create a token\n                const token = jwt.sign(user, TOKEN_SECRET, {\n                    expiresIn // expires in 60 seconds\n                });\n                // return the information including token as JSON\n                res.json({\n                    success: true,\n                    message: 'Enjoy your token!',\n                    token,\n                    expiresIn\n                });\n            });\n        }\n        catch (e) {\n            log(e);\n            res.send({ error: 'error in your request' });\n        }\n    }\n}\nexport default AuthenticationController;\n//# sourceMappingURL=AuthenticationController.js.map"]}