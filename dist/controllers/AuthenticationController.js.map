{"version":3,"sources":["../../dist-esnext/controllers/AuthenticationController.js"],"names":["AuthenticationController","req","res","next","token","body","query","headers","verify","err","decoded","json","success","message","status","send","userName","name","userBusiness","findOne","error","user","password","sign","expiresIn","e","console","log"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;IACMA,wB;;;;;;;oCACUC,G,EAAKC,G,EAAKC,I,EAAM;AACxB;AACA,gBAAMC,QAAQH,IAAII,IAAJ,CAASD,KAAT,IAAkBH,IAAIK,KAAJ,CAAUF,KAA5B,IAAqCH,IAAIM,OAAJ,CAAY,gBAAZ,CAAnD;AACA;AACA,gBAAIH,KAAJ,EAAW;AACP;AACA,uCAAII,MAAJ,CAAWJ,KAAX,EAAkB,SAAlB,EAA6B,UAACK,GAAD,EAAMC,OAAN,EAAkB;AAC3C,wBAAID,GAAJ,EAAS;AACLP,4BAAIS,IAAJ,CAAS,EAAEC,SAAS,KAAX,EAAkBC,SAAS,+BAA3B,EAAT;AACH,qBAFD,MAGK;AACD;AACAZ,4BAAIS,OAAJ,GAAcA,OAAd;AACAP;AACH;AACJ,iBATD;AAUH,aAZD,MAaK;AACD;AACA;AACAD,oBAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACjBH,6BAAS,KADQ;AAEjBC,6BAAS;AAFQ,iBAArB;AAIH;AACJ;;;yCACgBZ,G,EAAKC,G,EAAK;AACvB,gBAAI;AACA,oBAAMc,WAAWf,IAAII,IAAJ,CAASY,IAA1B;AACA,oBAAMC,eAAe,4BAArB;AACAA,6BAAaC,OAAb,CAAqBH,QAArB,EAA+B,UAACI,KAAD,EAAQC,IAAR,EAAiB;AAC5C,wBAAID,KAAJ,EACI,OAAOlB,IAAIa,IAAJ,CAAS,EAAEK,OAAO,OAAT,EAAT,CAAP;AACJ,wBAAI,CAACC,IAAL,EACI,OAAOnB,IAAIS,IAAJ,CAAS,EAAEC,SAAS,KAAX,EAAkBC,SAAS,wCAA3B,EAAT,CAAP;AACJ;AACA,wBAAIQ,KAAKC,QAAL,KAAkBrB,IAAII,IAAJ,CAASiB,QAA/B,EACI,OAAOpB,IAAIS,IAAJ,CAAS,EAAEC,SAAS,KAAX,EAAkBC,SAAS,wCAA3B,EAAT,CAAP;AACJ;AACA;AACA,wBAAMT,QAAQ,uBAAImB,IAAJ,CAASF,IAAT,EAAe,SAAf,EAA0B;AACpCG,mCAAW,IADyB,CACpB;AADoB,qBAA1B,CAAd;AAGA;AACAtB,wBAAIS,IAAJ,CAAS;AACLC,iCAAS,IADJ;AAELC,iCAAS,mBAFJ;AAGLT,oCAHK;AAILoB,mCAAW;AAJN,qBAAT;AAMH,iBApBD;AAqBH,aAxBD,CAyBA,OAAOC,CAAP,EAAU;AACNC,wBAAQC,GAAR,CAAYF,CAAZ;AACAvB,oBAAIa,IAAJ,CAAS,EAAEK,OAAO,uBAAT,EAAT;AACH;AACJ;;;;;;kBAEUpB,wB;AACf","file":"AuthenticationController.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport UserBusiness from './../app/business/UserBusiness';\nclass AuthenticationController {\n    verifyToken(req, res, next) {\n        // check header or url parameters or post parameters for token\n        const token = req.body.token || req.query.token || req.headers['x-access-token'];\n        // decode token\n        if (token) {\n            // verifies secret and checks exp\n            jwt.verify(token, 'fcamara', (err, decoded) => {\n                if (err) {\n                    res.json({ success: false, message: 'Failed to authenticate token.' });\n                }\n                else {\n                    // if everything is good, save to request for use in other routes\n                    req.decoded = decoded;\n                    next();\n                }\n            });\n        }\n        else {\n            // if there is no token\n            // return an error\n            res.status(403).send({\n                success: false,\n                message: 'No token provided.'\n            });\n        }\n    }\n    authenticateUser(req, res) {\n        try {\n            const userName = req.body.name;\n            const userBusiness = new UserBusiness();\n            userBusiness.findOne(userName, (error, user) => {\n                if (error)\n                    return res.send({ error: 'error' });\n                if (!user)\n                    return res.json({ success: false, message: 'Authentication failed. User not found.' });\n                // check if password matches\n                if (user.password !== req.body.password)\n                    return res.json({ success: false, message: 'Authentication failed. Wrong password.' });\n                // if user is found and password is right\n                // create a token\n                const token = jwt.sign(user, 'fcamara', {\n                    expiresIn: 1000 // expires in 60 seconds\n                });\n                // return the information including token as JSON\n                res.json({\n                    success: true,\n                    message: 'Enjoy your token!',\n                    token,\n                    expiresIn: 1000\n                });\n            });\n        }\n        catch (e) {\n            console.log(e);\n            res.send({ error: 'error in your request' });\n        }\n    }\n}\nexport default AuthenticationController;\n//# sourceMappingURL=AuthenticationController.js.map"]}